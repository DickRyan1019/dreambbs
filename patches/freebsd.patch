From 70e2f10c40fb1eb2b333602aef2d41cb3e7c70bc Mon Sep 17 00:00:00 2001
From: holishing <holishingtest@gmail.com>
Date: Wed, 14 Mar 2018 02:33:18 +0800
Subject: [PATCH 01/11] Makefile: try clang to compatible with FreeBSD

---
 innbbsd/Makefile | 4 ++--
 lib/Makefile     | 6 +++---
 maple/Makefile   | 6 +++---
 so/Makefile      | 6 +++---
 so/pip.c         | 6 +++---
 util/Makefile    | 6 +++---
 6 files changed, 17 insertions(+), 17 deletions(-)

diff --git a/innbbsd/Makefile b/innbbsd/Makefile
index a8206b2..8a43495 100755
--- a/innbbsd/Makefile
+++ b/innbbsd/Makefile
@@ -27,10 +27,10 @@ all:
 	@echo " make freebsd : for BSD 4.4 systems" 
 
 linux:
-	@$(MAKE) CC=gcc CFLAGS="-g -m32 -O2 -pipe -I../include -fomit-frame-pointer -Wunused" LDFLAGS="-m32 -L../lib -ldao" $(EXE)
+	@$(MAKE) CC=clang CFLAGS="-g -m32 -O2 -pipe -I../include -fomit-frame-pointer -Wunused" LDFLAGS="-m32 -L../lib -ldao" $(EXE)
 
 freebsd:
-	@$(MAKE) CC=gcc CFLAGS="-g -O2 -pipe -I../include -fomit-frame-pointer -Wunused" LDFLAGS="-L../lib -ldao" $(EXE)
+	@$(MAKE) CC=clang CFLAGS="-g -m32 -O2 -pipe -I../include -fomit-frame-pointer -Wunused" LDFLAGS="-m32 -L../lib -ldao" $(EXE)
 
 
 
diff --git a/lib/Makefile b/lib/Makefile
index 57d4ae4..44c469b 100644
--- a/lib/Makefile
+++ b/lib/Makefile
@@ -8,10 +8,10 @@
 # ------------------------------------------------------ #
 
 
-CC	= gcc
+CC	= clang
 RANLIB	= ranlib
-CPROTO	= `which cproto` -E"gcc -pipe -E" -I../include
-CFLAGS	= -O2 -pipe -fomit-frame-pointer -Wunused -I../include -m32
+CPROTO	= `which cproto` -E"clang -pipe -E" -I../include
+CFLAGS	= -m32 -O2 -pipe -fomit-frame-pointer -Wunused -I../include
 
 
 # ------------------------------------------------------ #
diff --git a/maple/Makefile b/maple/Makefile
index 0718ee0..2b0ef0e 100644
--- a/maple/Makefile
+++ b/maple/Makefile
@@ -29,7 +29,7 @@ OBJ =	acct.o bbsd.o board.o cache.o edit.o\
 EXE =	bbsd xchatd
 
 
-CPROTO  = `which cproto` -E"gcc -pipe -E" -I../include -I/usr/local/include
+CPROTO  = `which cproto` -E"clang -pipe -E" -I../include -I/usr/local/include
 
 .SUFFIXES: .o .c
 
@@ -41,10 +41,10 @@ all:
 	@echo " make freebsd : for BSD 4.4 systems"
 
 linux:
-	@$(MAKE) CC=gcc CPROTO="cproto -E\"gcc -pipe -E\" -I../include" CFLAGS="-g -m32 -DLINUX -O2 -pipe -fomit-frame-pointer -Wunused -I../include" LDFLAGS="-m32 -L../lib -ldao -lcrypt -lresolv -ldl -rdynamic" $(EXE)
+	@$(MAKE) CC=clang CPROTO="cproto -E\"clang -pipe -E\" -I../include" CFLAGS="-g -m32 -DLINUX -O2 -pipe -fomit-frame-pointer -Wunused -I../include" LDFLAGS="-m32 -L../lib -ldao -lcrypt -lresolv -ldl -rdynamic" $(EXE)
 
 freebsd:
-	@$(MAKE) CC=gcc CFLAGS="-g -DBSD44 -Os -pipe -fomit-frame-pointer -Wunused -I../include" LDFLAGS="-L../lib -ldao -lcrypt -export-dynamic" $(EXE)
+	@$(MAKE) CC=clang CFLAGS="-g -m32 -DBSD44 -Os -pipe -fomit-frame-pointer -Wunused -I../include" LDFLAGS="-m32 -L../lib -ldao -lcrypt -export-dynamic" $(EXE)
 
 xchatd:	xchatd.o
 	$(CC) -o $@ $? $(LDFLAGS)
diff --git a/so/Makefile b/so/Makefile
index 123d2ca..b2dca41 100644
--- a/so/Makefile
+++ b/so/Makefile
@@ -33,7 +33,7 @@ ETC =	Makefile $(HDR)
 .c.o:   ;   $(CC) $(MAKEFLAG) $(CFLAGS) -c $*.c
 .c.x:   ;   $(CPROTO) -o $*.x $*.c
 .c.ln:  ;   lint -abhi $*.c
-.o.so:	;   ld -s -G $*.o -o $*.so -L../lib -ldao -melf_i386
+.o.so:	;   ld -s -G $*.o -o $*.so -L../lib -ldao -melf_i386_fbsd
 
 
 all: 
@@ -42,10 +42,10 @@ all:
 	@echo " make freebsd : for BSD 4.4 systems"
 
 linux:
-	@$(MAKE) CC=gcc CPROTO="cproto -E\"gcc -pipe -E\" -I../include" CFLAGS="-g -m32 -DLINUX -DREDHAT -DREDHAT7 -O2 -pipe -fomit-frame-pointer -Wunused -I../include" LDFLAGS="-m32 -L../lib -ldao -lcrypt -lresolv -ldl -rdynamic" $(EXE)
+	@$(MAKE) CC=clang CPROTO="cproto -E\"clang -pipe -E\" -I../include" CFLAGS="-g -m32 -DLINUX -DREDHAT -DREDHAT7 -O2 -pipe -fomit-frame-pointer -Wunused -I../include" LDFLAGS="-m32 -L../lib -ldao -lcrypt -lresolv -ldl -rdynamic" $(EXE)
 
 freebsd:
-	@$(MAKE) CC=gcc CPROTO="cproto -E\"gcc -pipe -E\" -I../include" MAKEFLAG=$(MAKEFLAG) CFLAGS="-g -DBSD44 -DTWO_LONGJMP_ARGS -O2 -pipe -fomit-frame-pointer -Wunused -I../include" LDFLAGS="-L../lib -ldao -lcrypt -export-dynamic" $(EXE)
+	@$(MAKE) CC=clang CPROTO="cproto -E\"clang -pipe -E\" -I../include" MAKEFLAG=$(MAKEFLAG) CFLAGS="-g -m32 -DBSD44 -DTWO_LONGJMP_ARGS -O2 -pipe -fomit-frame-pointer -Wunused -I../include" LDFLAGS="-m32 -L../lib -ldao -lcrypt -export-dynamic" $(EXE)
 
 so: $(SO)
 
diff --git a/so/pip.c b/so/pip.c
index be9dae0..9c62975 100644
--- a/so/pip.c
+++ b/so/pip.c
@@ -6415,7 +6415,7 @@ pip_money()
 	char buf[100], ans[10];
 
 	int money = -1;
-	if (!d.name[0] || d.death) return;
+	if (!d.name[0] || d.death) return 0;
 	clrchyiuan(6, 18);
 	/*  move(12,0);
 	  clrtobot();*/
@@ -6424,7 +6424,7 @@ pip_money()
 	while (money < 0 || money > cuser.request)
 	{
 		getdata(10, 0, "要換多少次? ", ans, 10, LCECHO, 0);
-		if (!ans[0]) return;
+		if (!ans[0]) return 0;
 		money = atol(ans);
 	}
 	sprintf(buf, "是否要轉換 %d 次 為 %d 雞金? [y/N]: ", money, money*1000);
@@ -7297,7 +7297,7 @@ pip_meet_vs_man()
 		else
 			vmsg("沒發生任何事！");
 	}
-	return;
+	return 0;
 }
 
 void
diff --git a/util/Makefile b/util/Makefile
index 115284c..3c0c15d 100644
--- a/util/Makefile
+++ b/util/Makefile
@@ -6,7 +6,7 @@
 #  update :   /  /  				 	  #
 # ------------------------------------------------------- #
 
-#CC	= gcc
+#CC	= clang
 #CFLAGS	= -O2 -pipe -I../include -fomit-frame-pointer -Wunused
 #LDFLAGS = -s -lresolv -lsocket -L../lib -ldao
 #LDFLAGS = -s -L../lib -ldao
@@ -38,10 +38,10 @@ all:
 	@echo " make freebsd : for BSD 4.4 systems" 
 
 linux:
-	@$(MAKE) CC=gcc CFLAGS="-g -m32 -DLINUX -DREDHAT -DREDHAT7 -O2 -pipe -I../include -fomit-frame-pointer -Wunused" LDFLAGS="-m32 -L../lib -ldao -lcrypt -lresolv" $(TOOL)
+	@$(MAKE) CC=clang CFLAGS="-g -m32 -DLINUX -DREDHAT -DREDHAT7 -O2 -pipe -I../include -fomit-frame-pointer -Wunused" LDFLAGS="-m32 -L../lib -ldao -lcrypt -lresolv" $(TOOL)
 
 freebsd:
-	@$(MAKE) CC=gcc MAKEFLAG=$(MAKEFLAG) CFLAGS="-g -O2 -pipe -I../include -fomit-frame-pointer -Wunused" LDFLAGS="-L../lib -ldao -lcrypt" $(TOOL)
+	@$(MAKE) CC=clang MAKEFLAG=$(MAKEFLAG) CFLAGS="-g -m32 -O2 -pipe -I../include -fomit-frame-pointer -Wunused" LDFLAGS="-m32 -L../lib -ldao -lcrypt" $(TOOL)
 
 msgall: msgall.o
 	$(CC) $(MAKEFLAG) -o $@ $? $(LDFLAGS)
-- 
2.15.1

